function n(e){return{all:e=e||new Map,on:function(t,i){var r=e.get(t);r?r.push(i):e.set(t,[i])},off:function(t,i){var r=e.get(t);r&&(i?r.splice(r.indexOf(i)>>>0,1):e.set(t,[]))},emit:function(t,i){var r=e.get(t);r&&r.slice().map(function(s){s(i)}),(r=e.get("*"))&&r.slice().map(function(s){s(t,i)})}}}function h(e){return new Promise((t)=>{setTimeout(t,e)})}function u(e,t){return setTimeout(t,e)}function m(e){clearTimeout(e)}function p(e,t){return new Promise((i)=>{setTimeout(()=>i(t()),e)})}function c(e,t,i){let r=i?.maxTimes;if(i?.callWhenStart){if(setTimeout(t,0),r)r-=1}if(r===void 0)return setInterval(t,e);if(r<1)return;const s=setInterval(()=>{if(--r<0)clearInterval(s);else t()},e);return s}function f(e){clearInterval(e)}function T(e,t){for(let i=e;i>0;--i)t()}class a{static defaultOptions={repeat:!1,callWhenStart:!1};delay;fn;repeat;callWhenStart;maxTimes;constructor(e,t,i){this.delay=e,this.fn=t;const r={...a.defaultOptions,...i};this.repeat=r.repeat,this.callWhenStart=r.callWhenStart,this.maxTimes=r.maxTimes}get running(){return Boolean(this.#e)}set running(e){e?this.start():this.stop()}get events(){return this.#s}get callTimes(){return this.#t}get remainTimes(){return this.maxTimes?this.maxTimes-this.#t:1/0}get hasMoreTrigger(){return this.repeat&&(this.maxTimes===void 0||this.#t<this.maxTimes-1)}start(){if(this.#e)return this;return this.#t=0,this.#s.emit("runningChanged",!0),this.#l()}stop(){if(!this.#e)return;clearTimeout(this.#e),this.#s.emit("runningChanged",!1),this.#h()}reset(){if(this.#t=0,!this.#e)return;return clearTimeout(this.#e),this.#l()}restart(){return this.stop(),this.start()}waitTriggered(){return new Promise((e,t)=>{this.#i.push(e),this.#r.push(t)})}waitStop(){return new Promise((e)=>this.#n.push(e))}#t=0;#e;#i=[];#r=[];#n=[];#s=n();#a(){this.#t+=1;try{const e=this.fn?.();for(let t of this.#i)t(e);this.#s.emit("triggered",e)}catch(e){for(let t of this.#r)t(e)}finally{if(this.#i.length=this.#r.length=0,!this.hasMoreTrigger)this.#h()}}#u(){if(this.hasMoreTrigger)this.#o();this.#a()}#o(){this.#e=setTimeout(this.#u.bind(this),this.delay)}#l(){if(this.callWhenStart)setTimeout(()=>this.#a(),0);if(!this.callWhenStart||(this.maxTimes??3)>=2)this.#o();return this}#h(){this.#e=void 0;for(let e of this.#r)e(new Error("Timer stopped"));this.#i.length=this.#r.length=0;for(let e of this.#n)e();this.#n.length=0}}export{h as sleep,c as repeatEvery,T as loop,f as cancelRepeat,m as cancelCallSync,u as callSyncAfter,p as callAfter,a as Timer};

//# debugId=CE19F01C1017250564756E2164756E21
//# sourceMappingURL=index.js.map
